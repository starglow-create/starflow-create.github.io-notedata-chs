<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>知识库笔记</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f4f4f4;
      color: #333;
      transition: all 0.3s ease;
    }
    .container {
      max-width: 800px;
      margin: 20px auto;
      padding: 20px;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      transition: all 0.3s ease;
    }
    h1, h2 {
      text-align: center;
      color: #555;
    }
    .section {
      margin-bottom: 20px;
    }
    label {
      display: block;
      margin: 10px 0 5px;
    }
    input, select, button, textarea {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    button {
      background-color: #007bff;
      color: white;
      cursor: pointer;
    }
    button:hover {
      background-color: #0056b3;
    }
    .note-list {
      list-style: none;
      padding: 0;
    }
    .note-item {
      padding: 10px;
      border-bottom: 1px solid #eee;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .note-actions button {
      margin-left: 10px;
    }
    .loading {
      text-align: center;
      color: #999;
    }
    .search-box {
      display: flex;
      gap: 10px;
    }
    .gallery {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
    }
    .gallery-item {
      position: relative;
      width: 100%;
      aspect-ratio: 1 / 1;
      overflow: hidden;
      border-radius: 8px;
    }
    .gallery-item img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .gallery-item button {
      position: absolute;
      bottom: 5px;
      right: 5px;
      background-color: rgba(0, 0, 0, 0.7);
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>📚 知识库笔记</h1>

    <!-- 自定义主题 -->
    <div class="section">
      <h2>🎨 自定义主题</h2>
      <label for="page-bg-color">页面背景颜色：</label>
      <input type="color" id="page-bg-color" value="#ffffff">
      <button onclick="applyBackgroundColor()">应用背景颜色</button>

      <label for="text-color">页面文字颜色：</label>
      <input type="color" id="text-color" value="#000000">
      <button onclick="applyTextColor()">应用文字颜色</button>

      <label for="card-bg-color">卡片背景颜色：</label>
      <input type="color" id="card-bg-color" value="#ffffff">
      <button onclick="applyCardBackgroundColor()">应用卡片背景颜色</button>

      <label for="card-text-color">卡片文字颜色：</label>
      <input type="color" id="card-text-color" value="#000000">
      <button onclick="applyCardTextColor()">应用卡片文字颜色</button>

      <label for="font-select">选择字体：</label>
      <select id="font-select">
        <option value="Arial">Arial</option>
        <option value="Courier New">Courier New</option>
        <option value="Georgia">Georgia</option>
        <option value="Verdana">Verdana</option>
      </select>
      <button onclick="applyFont()">应用字体</button>
    </div>

    <!-- 自定义背景图片 -->
    <div class="section">
      <h2>🖼️ 自定义背景图片</h2>
      <input type="file" id="background-image-upload" accept="image/*">
      <button onclick="applyBackgroundImage()">应用背景图片</button>
    </div>

    <!-- 笔记记录 -->
    <div class="section">
      <h2>📝 记录笔记</h2>
      <select id="note-type" style="width: 100%;">
        <option value="💡 灵感">💡 灵感</option>
        <option value="📖 日记">📖 日记</option>
        <option value="📚 学习">📚 学习</option>
      </select>
      <textarea id="note-content" placeholder="写下你的笔记..."></textarea>
      <button onclick="saveNote()">保存笔记</button>
    </div>

    <!-- 查询功能 -->
    <div class="section search-box">
      <h2>🔍 查询笔记</h2>
      <input type="text" id="search-note" placeholder="输入关键词查询笔记..." oninput="searchNotes()">
    </div>

    <!-- 我的笔记 -->
    <div class="section">
      <h2>📜 我的笔记</h2>
      <ul id="note-list" class="note-list"></ul>
    </div>

    <!-- 图片上传与九宫格展示 -->
    <div class="section">
      <h2>🖼️ 图片上传</h2>
      <input type="file" id="image-upload" accept="image/*" multiple>
      <div class="gallery" id="gallery"></div>
    </div>

    <!-- 随机语录 -->
    <div class="section">
      <h2>🌟 随机语录</h2>
      <button onclick="getRandomQuote()">获取随机语录</button>
      <p id="quote" class="loading">加载中...</p>
    </div>
  </div>

  <script>
    let notes = [];
    let images = [];

    // 初始化数据：从 localStorage 加载数据
    function loadData() {
      const savedNotes = localStorage.getItem('notes');
      const savedImages = localStorage.getItem('images');
      const savedSettings = localStorage.getItem('settings');

      if (savedNotes) {
        try {
          notes = JSON.parse(savedNotes);
          renderNotes();
        } catch (e) {
          console.error('无法解析笔记数据:', e);
          notes = [];
        }
      }

      if (savedImages) {
        try {
          images = JSON.parse(savedImages);
          renderGallery();
        } catch (e) {
          console.error('无法解析图片数据:', e);
          images = [];
        }
      }

      if (savedSettings) {
        try {
          const settings = JSON.parse(savedSettings);
          applySavedSettings(settings);
        } catch (e) {
          console.error('无法解析设置数据:', e);
        }
      }
    }

    // 保存数据到 localStorage
    function saveData() {
      try {
        localStorage.setItem('notes', JSON.stringify(notes));
        localStorage.setItem('images', JSON.stringify(images));
        saveSettings();
      } catch (e) {
        console.error('无法保存数据到 localStorage:', e);
      }
    }

    // 保存自定义设置
    function saveSettings() {
      const settings = {
        pageBackgroundColor: document.getElementById('page-bg-color').value,
        textColor: document.getElementById('text-color').value,
        cardBackgroundColor: document.getElementById('card-bg-color').value,
        cardTextColor: document.getElementById('card-text-color').value,
        font: document.getElementById('font-select').value,
        backgroundImage: document.body.style.backgroundImage || ''
      };
      localStorage.setItem('settings', JSON.stringify(settings));
    }

    // 应用保存的自定义设置
    function applySavedSettings(settings) {
      document.body.style.backgroundColor = settings.pageBackgroundColor;
      document.body.style.color = settings.textColor;
      document.querySelector('.container').style.backgroundColor = settings.cardBackgroundColor;
      document.querySelector('.container').style.color = settings.cardTextColor;
      document.body.style.fontFamily = settings.font;
      if (settings.backgroundImage) {
        document.body.style.backgroundImage = settings.backgroundImage;
        document.body.style.backgroundSize = 'cover';
        document.body.style.backgroundPosition = 'center';
      }

      // 恢复输入框和下拉菜单的值
      document.getElementById('page-bg-color').value = settings.pageBackgroundColor;
      document.getElementById('text-color').value = settings.textColor;
      document.getElementById('card-bg-color').value = settings.cardBackgroundColor;
      document.getElementById('card-text-color').value = settings.cardTextColor;
      document.getElementById('font-select').value = settings.font;
    }

    // 应用页面背景颜色
    function applyBackgroundColor() {
      const color = document.getElementById('page-bg-color').value;
      document.body.style.backgroundColor = color;
      saveSettings(); // 保存设置
    }

    // 应用页面文字颜色
    function applyTextColor() {
      const color = document.getElementById('text-color').value;
      document.body.style.color = color;
      saveSettings(); // 保存设置
    }

    // 应用卡片背景颜色
    function applyCardBackgroundColor() {
      const color = document.getElementById('card-bg-color').value;
      document.querySelector('.container').style.backgroundColor = color;
      saveSettings(); // 保存设置
    }

    // 应用卡片文字颜色
    function applyCardTextColor() {
      const color = document.getElementById('card-text-color').value;
      document.querySelector('.container').style.color = color;
      saveSettings(); // 保存设置
    }

    // 应用字体
    function applyFont() {
      const font = document.getElementById('font-select').value;
      document.body.style.fontFamily = font;
      saveSettings(); // 保存设置
    }

    // 应用背景图片
    function applyBackgroundImage() {
      const fileInput = document.getElementById('background-image-upload');
      if (fileInput.files.length > 0) {
        const file = fileInput.files[0];
        const reader = new FileReader();
        reader.onload = function(e) {
          document.body.style.backgroundImage = `url(${e.target.result})`;
          document.body.style.backgroundSize = 'cover';
          document.body.style.backgroundPosition = 'center';
          saveSettings(); // 保存设置
        };
        reader.readAsDataURL(file);
      }
    }

    // 保存笔记
    function saveNote() {
      const type = document.getElementById('note-type').value;
      const content = document.getElementById('note-content').value;
      if (content.trim() === '') {
        alert('笔记内容不能为空！');
        return;
      }
      const timestamp = new Date().toLocaleString();
      const note = { type, content, timestamp };
      notes.push(note);
      renderNotes();
      document.getElementById('note-content').value = '';
      saveData(); // 保存到 localStorage
    }

    // 渲染笔记列表
    function renderNotes() {
      const noteList = document.getElementById('note-list');
      noteList.innerHTML = '';
      notes.forEach((note, index) => {
        const li = document.createElement('li');
        li.className = 'note-item';
        li.id = `note-${index}`;
        li.innerHTML = `
          <div>
            <strong>${note.type}</strong>: ${note.content} 
            <small>(${note.timestamp})</small>
          </div>
          <div class="note-actions">
            <button onclick="editNote(${index})">编辑</button>
            <button onclick="deleteNote(${index})">删除</button>
          </div>
        `;
        noteList.appendChild(li);
      });
    }

    // 编辑笔记
    function editNote(index) {
      const newContent = prompt('请输入新的笔记内容：', notes[index].content);
      if (newContent !== null) {
        notes[index].content = newContent;
        notes[index].timestamp = new Date().toLocaleString();
        renderNotes();
        saveData(); // 保存到 localStorage
      }
    }

    // 删除笔记
    function deleteNote(index) {
      if (confirm('确定要删除这条笔记吗？')) {
        notes.splice(index, 1);
        renderNotes();
        saveData(); // 保存到 localStorage
      }
    }

    // 查询笔记并自动定位
    function searchNotes() {
      const query = document.getElementById('search-note').value.toLowerCase();
      if (query.trim() === '') {
        return;
      }
      const matchedIndex = notes.findIndex(note =>
        note.content.toLowerCase().includes(query)
      );
      if (matchedIndex !== -1) {
        const targetNote = document.getElementById(`note-${matchedIndex}`);
        if (targetNote) {
          targetNote.scrollIntoView({ behavior: 'smooth', block: 'center' });
          targetNote.style.backgroundColor = '#d4edda'; // 高亮显示
          setTimeout(() => {
            targetNote.style.backgroundColor = ''; // 恢复原样
          }, 2000);
        }
      } else {
        alert('未找到匹配的笔记！');
      }
    }

    // 图片上传与九宫格展示
    function uploadImages() {
      const files = document.getElementById('image-upload').files;
      Array.from(files).forEach(file => {
        const reader = new FileReader();
        reader.onload = function(e) {
          const img = new Image();
          img.src = e.target.result;

          // 裁剪为正方形
          img.onload = function() {
            const canvas = document.createElement('canvas');
            const size = Math.min(img.width, img.height);
            canvas.width = size;
            canvas.height = size;
            const ctx = canvas.getContext('2d');
            ctx.drawImage(img, (img.width - size) / 2, (img.height - size) / 2, size, size, 0, 0, size, size);

            const croppedImage = canvas.toDataURL();
            images.push(croppedImage);
            renderGallery();
            saveData(); // 保存到 localStorage
          };
        };
        reader.readAsDataURL(file);
      });
    }

    // 渲染九宫格图片
    function renderGallery() {
      const gallery = document.getElementById('gallery');
      gallery.innerHTML = '';
      images.forEach((image, index) => {
        const div = document.createElement('div');
        div.className = 'gallery-item';
        div.innerHTML = `
          <img src="${image}" alt="上传的图片">
          <button onclick="deleteImage(${index})">删除</button>
        `;
        gallery.appendChild(div);
      });
    }

    // 删除图片
    function deleteImage(index) {
      if (confirm('确定要删除这张图片吗？')) {
        images.splice(index, 1);
        renderGallery();
        saveData(); // 保存到 localStorage
      }
    }

    // 随机语录（35条创意句子）
    const quotes = [
      "人生没有白走的路，每一步都算数。",
      "梦想从不只是梦，脚踏实地才是真。",
      "世界因你而更加美好。",
      "所有的光鲜亮丽，背后都有不为人知的努力。",
      "坚持下去，你比想象中更强大。",
      "不要害怕改变，因为改变是成长的开始。",
      "每一次失败，都是成功的伏笔。",
      "心怀希望，未来可期。",
      "平凡的脚步，也能走出伟大的旅程。",
      "努力是为了遇见更好的自己。",
      "生活不是等待风暴过去，而是学会在雨中起舞。",
      "今天的努力，是为了明天的自由。",
      "成功不是偶然，而是日积月累的结果。",
      "相信自己，你是最棒的。",
      "越努力，越幸运。",
      "微笑面对生活，阳光总会照进来。",
      "每一滴汗水，都会浇灌出未来的花朵。",
      "做自己的英雄，无需他人认可。",
      "人生如逆水行舟，不进则退。",
      "梦想不会逃跑，逃跑的往往是自己。",
      "每一天都是一个新的起点。",
      "坚持初心，方得始终。",
      "不怕路长，只怕志短。",
      "与其抱怨黑暗，不如提灯前行。",
      "只有拼尽全力，才能看起来毫不费力。",
      "把时间留给重要的事，把爱留给值得的人。",
      "生命的意义在于不断超越自己。",
      "别在最能吃苦的年纪，选择了安逸。",
      "真正的强者，是含着泪还在奔跑的人。",
      "只要心中有光，黑暗就无法将你吞噬。",
      "行动是治愈恐惧的良药。",
      "你若盛开，清风自来。",
      "前路漫漫，唯有奋斗不负青春。",
      "所有的努力，终将成就更好的自己。"
    ];

    // 获取随机语录
    function getRandomQuote() {
      const randomIndex = Math.floor(Math.random() * quotes.length);
      document.getElementById('quote').textContent = quotes[randomIndex];
    }

    // 初始化事件监听
    window.onload = function() {
      loadData(); // 加载数据
      getRandomQuote();
      document.getElementById('image-upload').addEventListener('change', uploadImages);
    };
  </script>
</body>
</html>